"use strict";function byIds(a,b){return a?a.filter(function(a){return-1!==b.indexOf(a.id)}):a}function photoLineFilter(a,b,c){if(!b)return a;var d=c.filter(function(a){return-1!==a.lineIds.indexOf(b)}).map(function(a){return a.id});return a.filter(function(a){return a.stationIds.some(function(a){return-1!==d.indexOf(a)})})}function photoQueryFilter(a,b){if(!b)return a;var c=new RegExp("\\b"+b,"i");return a.filter(function(a){return a.name.match(c)?!0:a.description.match(c)?!0:!1})}var relsolveAll={photos:["Photo",function(a){return a.query().$promise}],lines:["Line",function(a){return a.query().$promise}],stations:["Station",function(a){return a.query().$promise}]};angular.module("app",["ngResource","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("/admin","/admin/photos").otherwise("/photos"),a.state("photos",{url:"/photos",templateUrl:"views/photos.html",controller:"PhotosCtrl",resolve:relsolveAll}).state("photos.photo",{url:"/:id",templateUrl:"views/photo.html",controller:"PhotoCtrl",onEnter:function(){document.body.style.overflow="hidden"},onExit:function(){document.body.style.overflow="auto"}}).state("admin",{url:"/admin",templateUrl:"views/admin/admin.html"}).state("admin.photos",{url:"/photos","abstract":!0,template:"<ui-view/>",resolve:{photos:["Photo",function(a){return a.query().$promise}]}}).state("admin.photos.index",{url:"",templateUrl:"views/admin/photos.html",controller:"AdminPhotosCtrl"}).state("admin.photos.photo",{url:"/:id",templateUrl:"views/admin/photo.html",controller:"AdminPhotoCtrl",resolve:{photo:["$stateParams","photos",function(a,b){return b[a.id]}]}}).state("admin.lines",{url:"/lines",templateUrl:"views/admin/lines.html",controller:"AdminLinesCtrl",resolve:{}}).state("admin.stations",{url:"/stations",templateUrl:"views/admin/stations.html",controller:"AdminStationsCtrl",resolve:{}})}]).run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c,a.$on("$stateChangeStart",function(a,b){var c=$("body");b.name.match(/^admin/)?(c.addClass("admin"),c.removeClass("main")):(c.addClass("main"),c.removeClass("admin"))})}]),angular.module("app").controller("AdminLinesCtrl",["$scope",function(){}]),angular.module("app").controller("AdminPhotoCtrl",["$scope","$state","Photo","photo",function(a,b,c,d){a.photo=d,a.legend="Edit Photo",a.save=function(a){a.$update(function(){b.go("admin.photos.index")})}}]),angular.module("app").controller("AdminPhotosCtrl",["$scope","photos",function(a,b){a.photos=b}]),angular.module("app").controller("AdminStationsCtrl",["$scope",function(){}]),angular.module("app").controller("FooterCtrl",["$scope",function(a){a.year=(new Date).getFullYear(),a.links=[{name:"facebook",url:"https://www.facebook.com/murphyz"},{name:"twitter",url:"https://twitter.com/murphyz"},{name:"tumblr",url:"http://murphyz.tumblr.com"},{name:"instagram",url:"https://instagram.com/murphyz"},{name:"flickr",url:"https://www.flickr.com/murphyzmike"},{name:"googleplus",url:"https://plus.google.com/+MichaelMurphy"}]}]),angular.module("app").controller("PhotoCtrl",["$scope","$stateParams","$state","Photo",function(a,b,c,d){a.photo=d.find(b.id),a.closeDialog=function(){c.go("photos")}}]),angular.module("app").controller("PhotosCtrl",["$scope","$filter","photos","lines","stations",function(a,b,c,d,e){a.query="",a.line=null,a.stations=e,a.lines=d,a.photos=c,a.$watchCollection("[line, query, photos]",function(c){var d=c[0],e=c[1];a.filteredPhotos=b("photoQueryFilter")(a.photos,e),a.filteredPhotos=b("photoLineFilter")(a.filteredPhotos,d,a.stations)}),a.filterByLine=function(b){a.line=b}}]),angular.module("app").directive("googleMap",function(){return{restrict:"AE",template:"<div></div>",replace:!0,link:function(a,b){function c(a){var b=new google.maps.LatLng(a.lat,a.lng),c=new google.maps.Marker({position:b,map:f});i.push(c)}function d(){i.forEach(function(a){a.setMap(null)}),i=[]}var e,f,g,h,i;g=51.5072,h=-.1275,e={zoom:13,center:new google.maps.LatLng(g,h)},i=[],f=new google.maps.Map(b[0],e),a.$watch("filteredPhotos",function(a){a instanceof Array&&(d(),a.forEach(function(a){c(a)}))},!0)}}}),angular.module("app").filter("byIds",function(){return byIds}),angular.module("app").filter("photoLineFilter",function(){return photoLineFilter}),angular.module("app").filter("photoQueryFilter",function(){return photoQueryFilter}),angular.module("app").factory("Line",["$resource",function(a){return a("/api/lines")}]),angular.module("app").factory("Photo",["$resource",function(a){return a("/api/photos/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("app").factory("Station",["$resource",function(a){return a("/api/stations")}]);